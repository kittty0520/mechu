(()=>{"use strict";async function e(){return await fetch("assets/data/foodDB.json").then((e=>e.json())).then((e=>e.map((e=>(e.ingre=e.ingre.split(","),e.cook=e.cook.split(","),e))))).catch(console.error)}e();const t=["오늘은 어느 나라 음식이 끌리시나요?","어떤 식재료가 좋을까요?","어떤 요리 방법이 좋으세요?","당신은 맵찔이 맵고수?","따뜻한 음식 ? 차가운 음식?"],n=[{answers:["한식","양식","중식","일식","기타"],multiSeleted:!0},{answers:["쌀","밀가루","육류","해산물","채소"],multiSeleted:!0},{answers:["튀김","구이","찜","볶음","기타"],multiSeleted:!0},{answers:["매움","안매움"],multiSeleted:!1},{answers:["온","냉"],multiSeleted:!1}],o=document.querySelector("#story"),c=document.querySelector(".cartoon__button"),r=[document.querySelector(".cartoon-first"),document.querySelector(".cartoon-second"),document.querySelector(".cartoon-third"),document.querySelector(".cartoon-final")],s=document.querySelector("#start"),l=document.querySelector(".start__question"),i=document.querySelector(".start__answers"),u=document.querySelector(".start__selectedPosition"),a=document.querySelector(".start__button"),d=document.querySelector(".start__button--random"),m=document.querySelector("#quest"),f=document.querySelector(".question__container"),p=document.querySelector(".sequence__counter__number"),y=document.querySelector(".sequence__subBar"),h=document.querySelector(".sequence__character"),g=document.querySelector(".answer__list"),b=document.querySelector(".answer__button"),k=document.querySelector("#loading"),_=document.querySelector("#result"),S=document.querySelector("#country_food"),q=document.querySelector("#btn_re");let v=0,L=0,w=0;const C=e();let E=[],A=0,T="",x=[];c.addEventListener("click",(function(){return 3===v&&(H(r[0],r[3]),H(o,s),v=0),H(r[v],r[v+1]),v++,v})),a.addEventListener("click",(()=>{const e=document.getElementsByName("position_chk");0!==[...e].filter((e=>e.checked)).length?(d.style.display="block",function(e){if("none"===i.style.display)return i.style.display="block",H(s,m),void B();i.style.display="none",a.textContent="시작하기",a.style.color="#ffffff",a.style.background="#ff924d",[...e].map((e=>{if(!e.checked)return e;{l.textContent=`${e.labels[0].innerHTML}님! 오늘 점심 추천해 드릴게요`;const t=document.createElement("img");t.setAttribute("class","start__selected__img"),t.setAttribute("src",`assets/img/${e.id}.png`),t.setAttribute("alt",e.value),u.appendChild(t),localStorage.setItem("position",e.id)}}))}(e)):alert("한 개 이상의 옵션을 선택하세요")})),d.addEventListener("click",(()=>{C.then((e=>I(e))).then((e=>K(e))),H(s,k),setTimeout((()=>{H(k,_)}),3e3)})),b.addEventListener("click",(()=>{if($(b,!1),T=M[A],A++,5===A&&(A=0),console.log(T),0===[...document.getElementsByName(T)].filter((e=>e.checked)).length)return alert("한 개 이상의 옵션을 선택하세요"),void A--;!function(e){let t=document.getElementsByName(e),n=[];for(let e=0;e<t.length;e++)if(t[e].checked){const o=t[e].value;n.push(o)}E.push(n),console.log(E)}(T),5===w&&C.then((e=>function(e,t){let n=e;for(let e=0;e<t.length;e++){let o=M[e],c=t[e];n=N(o,n,c),console.log(o,c)}return n}(e,E))).then((e=>I(e))).then((e=>K(e))),B()}));const M=["country","ingre","cook","spicy","temp"];function B(){f.innerHTML="",g.innerHTML="",L<t.length?(function(){const e=document.createElement("div");e.setAttribute("class","newQuestion");const n=t[L].toString();L++,e.innerHTML=n,f.appendChild(e)}(),function(){const{multiSeleted:e}=n[w];if(e){const e=document.createElement("p");e.setAttribute("class","isMultiSelct"),e.innerHTML="(중복 선택 가능)",f.appendChild(e)}}(),function(){const{answers:e,multiSeleted:t}=n[w];e.map(((e,n)=>{const o=document.createElement("input");!1===t?o.setAttribute("type","radio"):o.setAttribute("type","checkbox"),o.setAttribute("id",`answer${n}`),o.setAttribute("value",e),o.setAttribute("name",M[w]);const c=document.createElement("label");c.setAttribute("for",`answer${n}`),c.setAttribute("class","answer__label"),c.innerHTML=e,g.appendChild(o),g.appendChild(c)}));w++}(),function(){if(1===w){h.innerHTML="";const e=localStorage.getItem("position");console.log(e);const t=document.createElement("img");t.setAttribute("class","sequence__bar__img"),t.setAttribute("src",`assets/img/${e}.png`),t.setAttribute("alt",e),h.appendChild(t)}const e=document.querySelector(".sequence__bar__img");p.innerHTML=w,e.style.left=40*w-12+"px",y.style.width=40*w+"px"}()):(H(m,k),L=0,w=0,b.textContent="다음으로",setTimeout((()=>{H(k,_)}),3e3))}function H(e,t){e.style.display="none",t.style.display="block"}function $(e,t){!0===t?(e.style.background="#ff924d",e.style.color="#ffffff"):(e.style.background="#eee",e.style.color="#ff924d")}function N(e,t,n){switch(e){case"country":case"spicy":case"temp":return function(e,t,n){const o=[];for(let c=0;c<n.length;c++)for(let r=0;r<t.length;r++)n[c]==t[r][e]&&o.push(t[r]);return console.log(e,o),o}(e,t,n);case"ingre":case"cook":return function(e,t,n){let o=[];return o=n.map((n=>t.filter((t=>t[e].includes(n))))).flat(),[...new Set(o)]}(e,t,n);default:return t}}document.addEventListener("click",(e=>{if("LABEL"===e.target.nodeName||"INPUT"===e.target.nodeName){const e=0===w?"position_chk":M[w-1];[...document.getElementsByName(e)].filter((e=>e.checked)).length>0&&($(0===w?a:b,!0),b.textContent=5===w?"결과보기":"다음으로")}}));let U="",j="";function I(e){return e.sort((()=>Math.random()-.5))}function K(e){if(0==e.length)return S.innerHTML="<p>더이상 추천해드릴 음식이 없어요.</p>",q.textContent="테스트 돌아가기",void(E=[]);const t=e.shift();var n,o;S.innerHTML=`<p>${t.name}</p><img src="assets/img/food_img/${t.src}.png" alt="음식이미지">`,x=e,U=`http://mechu.dothome.co.kr/assets/img/food_img/${t.src}.png`.toString(),j=t.name,n=`http://mechu.dothome.co.kr/assets/img/food_img/${t.src}.png`.toString(),o=t.name,Kakao.init("612462421afd5bbec717bb6f32ebff8c"),Kakao.Share.createDefaultButton({container:"#kakaotalk-sharing-btn",objectType:"feed",content:{title:`${o} 추천드려요!`,description:"#점심 #점심메뉴 #점심메뉴추천",imageUrl:n||"http://k.kakaocdn.net/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png",link:{mobileWebUrl:"http://mechu.dothome.co.kr",webUrl:"http://mechu.dothome.co.kr"}},social:{likeCount:286,commentCount:45,sharedCount:845},buttons:[{title:"웹으로 보기",link:{mobileWebUrl:"https://developers.kakao.com",webUrl:"https://developers.kakao.com"}}]})}q.addEventListener("click",(()=>{if("테스트 돌아가기"===q.textContent)return H(_,m),q.textContent="다른 결과보기",void B();S.innerHTML="",K(x)})),document.querySelector("#clip-btn").addEventListener("click",(()=>{!function(){var e=document.createElement("textarea");e.value="http://mechu.dothome.co.kr/",e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),e.setSelectionRange(0,9999);var t=document.execCommand("copy");document.body.removeChild(e),t?alert("클립보드에 복사가 완료되었습니다."):alert("클립보드 복사에 실패하였습니다.")}()}))})();